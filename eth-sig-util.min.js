/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/eth-sig-util@2.4.4/index.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const{Buffer:Buffer}=require("buffer"),ethUtil=require("ethereumjs-util"),ethAbi=require("ethereumjs-abi"),nacl=require("tweetnacl");nacl.util=require("tweetnacl-util");const TYPED_MESSAGE_SCHEMA={type:"object",properties:{types:{type:"object",additionalProperties:{type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string"}},required:["name","type"]}}},primaryType:{type:"string"},domain:{type:"object"},message:{type:"object"}},required:["types","primaryType","domain","message"]},TypedDataUtils={encodeData(e,t,r,n=!0){const i=["bytes32"],o=[this.hashType(e,r)];if(n){const a=(e,t,i)=>{if(void 0!==r[t])return["bytes32",null==i?"0x0000000000000000000000000000000000000000000000000000000000000000":ethUtil.sha3(this.encodeData(t,i,r,n))];if(void 0===i)throw new Error(`missing value for field ${e} of type ${t}`);if("bytes"===t)return["bytes32",ethUtil.sha3(i)];if("string"===t)return"string"==typeof i&&(i=Buffer.from(i,"utf8")),["bytes32",ethUtil.sha3(i)];if(t.lastIndexOf("]")===t.length-1){const r=t.slice(0,t.lastIndexOf("[")),n=i.map(t=>a(e,r,t));return["bytes32",ethUtil.sha3(ethAbi.rawEncode(n.map(([e])=>e),n.map(([,e])=>e)))]}return[t,i]};for(const n of r[e]){const[e,r]=a(n.name,n.type,t[n.name]);i.push(e),o.push(r)}}else for(const a of r[e]){let e=t[a.name];if(void 0!==e)if("bytes"===a.type)i.push("bytes32"),e=ethUtil.sha3(e),o.push(e);else if("string"===a.type)i.push("bytes32"),"string"==typeof e&&(e=Buffer.from(e,"utf8")),e=ethUtil.sha3(e),o.push(e);else if(void 0!==r[a.type])i.push("bytes32"),e=ethUtil.sha3(this.encodeData(a.type,e,r,n)),o.push(e);else{if(a.type.lastIndexOf("]")===a.type.length-1)throw new Error("Arrays currently unimplemented in encodeData");i.push(a.type),o.push(e)}}return ethAbi.rawEncode(i,o)},encodeType(e,t){let r="",n=this.findTypeDependencies(e,t).filter(t=>t!==e);n=[e].concat(n.sort());for(const e of n){if(!t[e])throw new Error("No type definition specified: "+e);r+=e+"("+t[e].map(({name:e,type:t})=>t+" "+e).join(",")+")"}return r},findTypeDependencies(e,t,r=[]){if(e=e.match(/^\w*/)[0],r.includes(e)||void 0===t[e])return r;r.push(e);for(const n of t[e])for(const e of this.findTypeDependencies(n.type,t,r))!r.includes(e)&&r.push(e);return r},hashStruct(e,t,r,n=!0){return ethUtil.sha3(this.encodeData(e,t,r,n))},hashType(e,t){return ethUtil.sha3(this.encodeType(e,t))},sanitizeData(e){const t={};for(const r in TYPED_MESSAGE_SCHEMA.properties)e[r]&&(t[r]=e[r]);return t.types&&(t.types=Object.assign({EIP712Domain:[]},t.types)),t},sign(e,t=!0){const r=this.sanitizeData(e),n=[Buffer.from("1901","hex")];return n.push(this.hashStruct("EIP712Domain",r.domain,r.types,t)),"EIP712Domain"!==r.primaryType&&n.push(this.hashStruct(r.primaryType,r.message,r.types,t)),ethUtil.sha3(Buffer.concat(n))}};function typedSignatureHash(e){const t=new Error("Expect argument to be non-empty array");if("object"!=typeof e||!e.length)throw t;const r=e.map(function(e){return"bytes"===e.type?ethUtil.toBuffer(e.value):e.value}),n=e.map(function(e){return e.type}),i=e.map(function(e){if(!e.name)throw t;return e.type+" "+e.name});return ethAbi.soliditySHA3(["bytes32","bytes32"],[ethAbi.soliditySHA3(new Array(e.length).fill("string"),i),ethAbi.soliditySHA3(n,r)])}function recoverPublicKey(e,t){const r=ethUtil.toBuffer(t),n=ethUtil.fromRpcSig(r);return ethUtil.ecrecover(e,n.v,n.r,n.s)}function getPublicKeyFor(e){const t=ethUtil.toBuffer(e.data);return recoverPublicKey(ethUtil.hashPersonalMessage(t),e.sig)}function padWithZeroes(e,t){for(var r=""+e;r.length<t;)r="0"+r;return r}function nacl_decodeHex(e){var t=Buffer.from(e,"hex").toString("base64");return nacl.util.decodeBase64(t)}module.exports={TYPED_MESSAGE_SCHEMA:TYPED_MESSAGE_SCHEMA,TypedDataUtils:TypedDataUtils,concatSig:function(e,t,r){const n=ethUtil.fromSigned(t),i=ethUtil.fromSigned(r),o=ethUtil.bufferToInt(e),a=padWithZeroes(ethUtil.toUnsigned(n).toString("hex"),64),s=padWithZeroes(ethUtil.toUnsigned(i).toString("hex"),64),c=ethUtil.stripHexPrefix(ethUtil.intToHex(o));return ethUtil.addHexPrefix(a.concat(s,c)).toString("hex")},normalize:function(e){if(e){if("number"==typeof e){const t=ethUtil.toBuffer(e);e=ethUtil.bufferToHex(t)}if("string"!=typeof e){var t="eth-sig-util.normalize() requires hex string or integer input.";throw new Error(t+=" received "+typeof e+": "+e)}return ethUtil.addHexPrefix(e.toLowerCase())}},personalSign:function(e,t){var r=ethUtil.toBuffer(t.data),n=ethUtil.hashPersonalMessage(r),i=ethUtil.ecsign(n,e);return ethUtil.bufferToHex(this.concatSig(i.v,i.r,i.s))},recoverPersonalSignature:function(e){const t=getPublicKeyFor(e),r=ethUtil.publicToAddress(t);return ethUtil.bufferToHex(r)},extractPublicKey:function(e){return"0x"+getPublicKeyFor(e).toString("hex")},typedSignatureHash:function(e){const t=typedSignatureHash(e);return ethUtil.bufferToHex(t)},signTypedDataLegacy:function(e,t){const r=typedSignatureHash(t.data),n=ethUtil.ecsign(r,e);return ethUtil.bufferToHex(this.concatSig(n.v,n.r,n.s))},recoverTypedSignatureLegacy:function(e){const t=recoverPublicKey(typedSignatureHash(e.data),e.sig),r=ethUtil.publicToAddress(t);return ethUtil.bufferToHex(r)},encrypt:function(e,t,r){switch(r){case"x25519-xsalsa20-poly1305":if(void 0===t.data)throw new Error('Cannot detect secret message, message params should be of the form {data: "secret message"} ');var n=nacl.box.keyPair();try{var i=nacl.util.decodeBase64(e)}catch(e){throw new Error("Bad public key")}var o=nacl.util.decodeUTF8(t.data),a=nacl.randomBytes(nacl.box.nonceLength),s=nacl.box(o,a,i,n.secretKey);return{version:"x25519-xsalsa20-poly1305",nonce:nacl.util.encodeBase64(a),ephemPublicKey:nacl.util.encodeBase64(n.publicKey),ciphertext:nacl.util.encodeBase64(s)};default:throw new Error("Encryption type/version not supported")}},encryptSafely:function(e,t,r){let n=t.data;if(!n)throw new Error("Cannot encrypt empty msg.data");if("object"==typeof n&&n.toJSON)throw new Error("Cannot encrypt with toJSON property.  Please remove toJSON property");const i={data:n,padding:""},o=Buffer.byteLength(JSON.stringify(i),"utf-8")%2048;let a=0;o>0&&(a=2048-o-16),i.padding="0".repeat(a);const s={data:JSON.stringify(i)};return this.encrypt(e,s,r)},decrypt:function(e,t){switch(e.version){case"x25519-xsalsa20-poly1305":var r=nacl_decodeHex(t),n=nacl.box.keyPair.fromSecretKey(r).secretKey,i=nacl.util.decodeBase64(e.nonce),o=nacl.util.decodeBase64(e.ciphertext),a=nacl.util.decodeBase64(e.ephemPublicKey),s=nacl.box.open(o,i,a,n);try{var c=nacl.util.encodeUTF8(s)}catch(e){throw new Error("Decryption failed.")}if(c)return c;throw new Error("Decryption failed.");default:throw new Error("Encryption type/version not supported.")}},decryptSafely:function(e,t){return JSON.parse(this.decrypt(e,t)).data},getEncryptionPublicKey:function(e){var t=nacl_decodeHex(e),r=nacl.box.keyPair.fromSecretKey(t).publicKey;return nacl.util.encodeBase64(r)},signTypedData:function(e,t){const r=TypedDataUtils.sign(t.data,!1),n=ethUtil.ecsign(r,e);return ethUtil.bufferToHex(this.concatSig(n.v,n.r,n.s))},signTypedData_v4:function(e,t){const r=TypedDataUtils.sign(t.data),n=ethUtil.ecsign(r,e);return ethUtil.bufferToHex(this.concatSig(n.v,n.r,n.s))},recoverTypedSignature:function(e){const t=recoverPublicKey(TypedDataUtils.sign(e.data,!1),e.sig),r=ethUtil.publicToAddress(t);return ethUtil.bufferToHex(r)},recoverTypedSignature_v4:function(e){const t=recoverPublicKey(TypedDataUtils.sign(e.data),e.sig),r=ethUtil.publicToAddress(t);return ethUtil.bufferToHex(r)}};
//# sourceMappingURL=/sm/eb83a0191fe2571f1e53605d20f7b68569adcd3844b2d6e5d8a9daffb61088de.map